var request = require('request')
var config = require('./config')
var log = require('./log')

request = request.defaults({
	proxy:'http://proxy.tencent.com:8080'
})

var getState = function(sch){
	var time = config.sch.t,
		date = config.sch.d

	return sch[time][date]['y_state']
}

var i = 0;
var check = function(){
	request.get({url: 'http://sz.91160.com/doc/getschmast/unit_id-103/dep_id-2534/doc_id-17741/date-.html'}, function(err, res, body){
		var data = JSON.parse(body)
		
		var state = getState(data.sch)

		//console.log(i++)
			log.info(state)
				log.on('line', function(line){
  console.log(line);
});
		//check()
	})
}
	
setInterval(check, 10)